# Веб-сервис для поиска сведений о локальных подсетях

Этот сервис позволяет получать сведения о локальной подсети по косвенным параметрам. Хранит данные во встроенной базе. Поддерживает работу с группами пользователей для удобного управления доступом. Предназначен для работы в корпоративных сетях с разделением на локальные подсети.

⚠️ _Поскольку сервис был разработан для использования в конкретной корпоративной сети конкретной компании, то многие данные внутри проекта были изменены, чтобы исключить проекта причастность к этой компании._

## Требования

- [Python](https://www.python.org/downloads/) >= 3.11
- [Django](https://github.com/django/django) >= 5.1.4
- [python-dotenv](https://github.com/theskumar/python-dotenv) >= 1.0.1

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/Spisocheg/network_analysis_service.git
   ```
2. Перейдите в директорию проекта:
   ```bash
   cd network_analysis_service
   ```

## Настройка и первый запуск

#### Windows
<details>
<summary>↓ Раскрыть ↓</summary>

1. Создайте виртуальное окружение. В корне проекта введите следующее:
   ```bash
   ... > python -m venv venv
   ```
2. После некоторой загрузки в корне проекта появится новая папка (с именем venv). Активируйте виртуальное окружение:
   ```bash
   ... > .\venv\Scripts\activate
   ```
3. В начале строки добавится имя виртуального окружения в скобках. Установите требуемые для работы библиотеки:
   ```bash
   (venv) ... > python -m pip install -r .\requirements.txt
   ```
4. Далее нужно сгенерировать секретный ключ и заполнить переменные окружения (раздел Переменные окружения). Генерация секретного ключа:
   ```bash
   (venv) ... > python -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())'
   ```
   Сгенерированный ключ следует скопировать из консоли и вставить в файл `.env` для переменной `SECRET_KEY` в соответствии с разделом Переменные окружения.
5. Теперь можно запустить веб-приложение:
   ```bash
   (venv) ... > python nas\manage.py runserser
   ```
</details>

#### Linux
<details>
<summary>↓ Раскрыть ↓</summary>

1. Создайте виртуальное окружение. В корне проекта введите следующее:
   ```bash
   ... ~$ python3 -m venv venv
   ```
2. После некоторой загрузки в корне проекта появится новая папка (с именем venv). Активируйте виртуальное окружение:
   ```bash
   ... ~$ source venv/bin/activate
   ```
3. В начале строки добавится имя виртуального окружения в скобках. Установите требуемые для работы библиотеки:
   ```bash
   (venv) ... ~$ python3 -m pip install -r .\requirements.txt
   ```
4. Далее нужно сгенерировать секретный ключ и заполнить переменные окружения (раздел Переменные окружения). Генерация секретного ключа:
   ```bash
   (venv) ... ~$ python3 -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())'
   ```
   Сгенерированный ключ следует скопировать из консоли и вставить в файл `.env` для переменной `SECRET_KEY` в соответствии с разделом Переменные окружения.
5. Теперь можно запустить веб-приложение:
   ```bash
   (venv) ... ~$ python3 nas\manage.py runserser
   ```
</details>

## Переменные окружения

Для запуска этого проекта потребуется создать файл .env в корне проекта (подробнее о расположении файлов: Структура проекта) и добавить туда следующие переменные (значения переменных указываются после символа равно `=`):

```env
# Django conf
SECRET_KEY=
DEBUG=True
```

## Демонстрация

#### 1. Главная страница для неавторизованного пользователя
<details>
<summary>спойлер</summary>

![main_page](https://github.com/user-attachments/assets/065188e9-00e7-4d7a-ac52-357aff655912)
</details>

#### 2. Главная страница для привилегированного пользователя
<details>
<summary>спойлер</summary>

![main_page_for_operator](https://github.com/user-attachments/assets/d1a92274-20ad-4635-a251-f9fdd47d9290)
</details>

#### 3. Страница входа в учетную запись
<details>
<summary>спойлер</summary>

![login_page](https://github.com/user-attachments/assets/22aaf170-03ed-43fc-9605-bd109ef329a1)
</details>

#### 4. Поиск информации о подсетях по введенным IP-адресам хостов _для инженера_ (доступно только авторизованным пользователям)

<details>
  <summary>↓ Раскрыть ↓</summary>
  
  ##### 4.1. Ввод
  <details>
  <summary>спойлер</summary>
  
  ![iptosub_page](https://github.com/user-attachments/assets/457fb21c-987d-41e0-bc18-f7c1a86ae063)
  </details>
  
  ##### 4.2. Результат
  <details>
  <summary>спойлер</summary>
  
  ![iptosub_page_w_result](https://github.com/user-attachments/assets/31a9acd4-6449-479c-83dd-54855cfbaf94)
  </details>
  
  ##### 4.3. Результат выгруженный в `.csv`
  <details>
  <summary>спойлер</summary>
  
  ![iptosub_result_csv](https://github.com/user-attachments/assets/eec36c01-8b0e-4077-9e3c-ea40aac6637c)
  </details>
</details>

#### 5. Поиск информации о подсетях по введенным IP-адресам хостов _для посетителя_ (доступно только авторизованным пользователям)

<details>
  <summary>↓ Раскрыть ↓</summary>
  
  ##### 5.1. Ввод
  <details>
  <summary>спойлер</summary>
  
  ![iptosub_visitor_page](https://github.com/user-attachments/assets/44e14cf7-1c16-4609-a7df-98ce8d2df869)
  </details>
  
  ##### 5.2. Результат
  <details>
  <summary>спойлер</summary>
  
  ![iptosub_visitor_page_w_result](https://github.com/user-attachments/assets/bb89f7e2-f52d-4da3-88f6-147e95501357)
  </details>
  
  ##### 5.3. Результат выгруженный в `.txt`
  <details>
  <summary>спойлер</summary>
  
  ![iptosub_visitor_result_txt](https://github.com/user-attachments/assets/e2303bb1-88c9-4b47-81e4-ea0e9e89dccc)
  </details>
</details>

#### 6. Страница обновления базы данных (доступно только привилегированным пользователям)
<details>
<summary>спойлер</summary>

![updatedb_page](https://github.com/user-attachments/assets/4ae67ec1-5e05-4013-a8ad-2c82906711c0)
</details>

#### 7. Страница с результатом обновления базы данных (доступно только привилегированным пользователям)
<details>
<summary>спойлер</summary>

![updatedb_page_w_result](https://github.com/user-attachments/assets/ad193493-64a0-4765-bedf-776d09d311b8)
</details>

## Использование

Примеры работы с описанием находятся в разделе Демонстрация. Здесь приведена необходимая информация для самостоятельного использования сервиса.

### Пользователи и иерархия

#### Данные пользователей

| логин | пароль   | уровень доступа | группа   |
|-------|----------|-----------------|----------|
| admin | admin    | superuser       | -        |
| oper1 | gHTstuiT | operator        | engineer |
| user1 | gHTstuiT | user            | visitor  |
| user2 | gHTstuiT | user            | engineer |

#### Иерархия доступа и групп

Доступы:
- `user`: может взаимодействовать с сервисом и получать данные при поиске
- `operator`: то же, что и `user`, но с добавлением возможности обновлять данные в базе данных (привилегированный пользователь)
- `superuser`: django superuser (доступен вход в админ-панель django и полное управление проектом)

Группы:
- `engineer`: результат - это информация о логической составляющей подсетей
- `visitor`: результат - это информация о физической составляющей корпоративной сети

### Доступные адресные пути сервиса
- `/` - главная
- `/iptosub/` - поиск информации о подсети по введенному IP-адресу хоста
- `/iptosub/updatedb/logical/` - обновление базы данных: логическая выгрузка
- `/iptosub/updatedb/physical/` - обновление базы данных: физическая выгрузка
- `/accounts/login/` - вход в учетную запись
- `/admin/` - стандартная "админка" Django

## Возможности и планы

- [x] Поиск информации о подсети по введенному IP-адресу хоста
- [x] Вывод разного результата для разных групп пользователей
- [x] Хранение логической и физической выгрузок в базе данных с удобным обновлением (доступно привилегированным пользователям)
- [x] Возможность скачать найденные данные файлом
- [x] Гибкий формат выводимого результата (пользователь может указать разделитель для данных, а также вывод зависит от группы, в которой пользователь состоит)
- [ ] Поиск информации в AD по введенному IP-адресу хоста (доменное имя ПК и прикрепленный пользователь)

## Структура проекта

```
network_analysis_service/
├── nas/
│   ├── accounts/                      # Модуль управления учетными записями
│   │   └── ...                     
│   ├── nas/                           # Модуль глобальной конфигурации
│   │   ├── settings.py                # Глобальные настройки проекта
│   │   ├── urls.py                    # Глобальная маршрутизация проекта
│   │   ├── views.py                   # Глобальное представление проекта
│   │   └── ...                     
│   ├── network_search/                # Модуль поиска информации о подсетях по IP хоста
│   │   ├── templates/                 # django-html файлы
│   │   │   └── ...                 
│   │   ├── templatetags/              # Кастомные теги
│   │   │   └── user_has_group.py      # Тег проверки наличия юзера в группе
│   │   ├── forms.py                   # Формы для ввода данных
│   │   ├── models.py                  # Описания моделей (таблиц)
│   │   ├── urls.py                    # Маршрутизатор
│   │   ├── views.py                   # Представления
│   │   └── ...
│   ├── static/                        # Статические файлы проекта
│   │   ├── css/                       # css файлы (в т.ч. лок. файлы bootstrap)
│   │   │   └── ...
│   │   ├── img/                       # Картинки, иконки
│   │   │   └── ...
│   │   └── js/                        # js скрипты
│   │       └── ...      
│   ├── db.sqlite3                     # База данных проекта
│   └── manage.py                      # Файл управления проектом
├── requirements.txt                   # Зависимости проекта
├── README.md                          # Описание проекта
├── .gitignore                         # Описание неотслеживаемых файлов git
├── .env                               # Файл с переменными окружения
├── test-network_search-logical.csv    # Тестовый файл для обновления БД с логич. выгрузкой
└── test-network_search-physical.csv   # Тестовый файл для обновления БД с физич. выгрузкой
```

⚠️ _Некоторые файлы и папки скрыты под `...` в дереве проекта_

---

Если есть вопросы, пишите: https://t.me/Spisocheg